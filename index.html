<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PO1 ULTIMATE FINAL (Persistent Data)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Anuphan:wght@300;400;600&family=Chakra+Petch:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root { --bg-dark: #0b1120; --glass: rgba(30, 41, 59, 0.85); }
        body { font-family: 'Anuphan', sans-serif; background-color: var(--bg-dark); color: white; overflow: hidden; }
        .font-tech { font-family: 'Chakra Petch', sans-serif; }
        
        /* Glass & Glow */
        .glass-panel { background: var(--glass); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 30px rgba(0,0,0,0.5); }
        .glow-num { text-shadow: 0 0 15px currentColor; }
        
        /* Transition */
        .smooth-move { transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .fade-enter { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Ticker */
        .ticker-wrap { width: 100%; overflow: hidden; white-space: nowrap; }
        .ticker { display: inline-block; padding-left: 100%; animation: ticker 40s linear infinite; }
        @keyframes ticker { to { transform: translateX(-100%); } }

        /* Transparent Mode */
        body.transparent .bg-main { background: transparent !important; }
        body.transparent .obs-hide { display: none !important; }
    </style>
</head>
<body>

<div id="app" class="w-full h-full"></div>

<script>
    // --- 1. CONFIG & STATE ---
    const STORAGE_KEY = 'PO1_FINAL_DB';
    
    const DEFAULT_DATA = {
        parties: [
            { id: 'p1', name: '‡∏û‡∏£‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô', color: '#FF9100', zone: 120, list: 30 },
            { id: 'p2', name: '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏ó‡∏¢', color: '#E60000', zone: 100, list: 25 },
            { id: 'p3', name: '‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏à‡πÑ‡∏ó‡∏¢', color: '#0033CC', zone: 50, list: 10 },
            { id: 'p4', name: '‡∏£‡∏ó‡∏™‡∏ä.', color: '#2C3E50', zone: 20, list: 5 }
        ],
        scene: 'dashboard', // dashboard, chart, parliament, winner
        ticker: '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏î‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á 2569 : ‡πÄ‡∏Å‡∏≤‡∏∞‡∏ï‡∏¥‡∏î‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå...',
        bg: 'dark'
    };

    // Load Data
    function loadState() {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : JSON.parse(JSON.stringify(DEFAULT_DATA));
    }
    
    function saveState(s) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
    }

    let state = loadState();
    let chartInstance = null; // ‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Å‡∏£‡∏≤‡∏ü

    // --- 2. ROUTER ---
    const app = document.getElementById('app');
    const params = new URLSearchParams(window.location.search);
    const mode = params.get('mode');

    if (!mode) renderMenu();
    else if (mode === 'control') initControl();
    else if (mode === 'onair') initOnAir();

    // --- 3. MENU ---
    function renderMenu() {
        app.innerHTML = `
            <div class="h-screen w-screen flex items-center justify-center bg-slate-950 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]">
                <div class="glass-panel p-10 rounded-2xl text-center max-w-lg w-full border-t-4 border-orange-500 shadow-2xl">
                    <h1 class="text-4xl font-tech font-bold text-white mb-2">PO1 <span class="text-orange-500">FINAL SYSTEM</span></h1>
                    <p class="text-slate-400 mb-8 text-xs uppercase tracking-widest">Persistent Data & Multi-Scene</p>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="location.href='?mode=control'" class="py-6 bg-slate-800 hover:bg-orange-600 border border-slate-600 rounded transition font-bold">üéõÔ∏è CONTROL</button>
                        <button onclick="location.href='?mode=onair'" class="py-6 bg-slate-800 hover:bg-blue-600 border border-slate-600 rounded transition font-bold">üì∫ ON-AIR</button>
                    </div>
                </div>
            </div>`;
    }

    // --- 4. CONTROL ROOM ---
    function initControl() {
        document.title = "Control Panel";
        
        function renderUI() {
            app.innerHTML = `
                <div class="flex h-screen bg-slate-950 text-white font-sans text-sm">
                    <div class="w-64 glass-panel border-r border-white/5 flex flex-col z-10">
                        <div class="p-4 border-b border-white/10 flex items-center gap-2">
                            <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                            <h2 class="font-bold text-slate-300">LIVE CONTROL</h2>
                        </div>
                        <div class="p-4 space-y-2">
                            <div class="text-[10px] text-slate-500 font-bold uppercase">SCENES</div>
                            ${['dashboard', 'chart', 'parliament', 'winner'].map(s => `
                                <button onclick="setScene('${s}')" class="w-full text-left p-3 rounded capitalize transition ${state.scene===s ? 'bg-orange-600 text-white font-bold shadow-lg' : 'hover:bg-white/5 text-slate-400'}">
                                    ${getSceneIcon(s)} ${s}
                                </button>
                            `).join('')}
                        </div>
                        <div class="mt-auto p-4 border-t border-white/10 space-y-3">
                            <div>
                                <div class="text-[10px] text-slate-500 font-bold mb-1">BACKGROUND</div>
                                <select onchange="setBg(this.value)" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-xs">
                                    <option value="dark" ${state.bg==='dark'?'selected':''}>Dark Studio</option>
                                    <option value="transparent" ${state.bg==='transparent'?'selected':''}>Transparent (OBS)</option>
                                </select>
                            </div>
                            <textarea oninput="setTicker(this.value)" class="w-full h-16 bg-slate-900 border border-slate-700 rounded p-2 text-xs resize-none" placeholder="Ticker...">${state.ticker}</textarea>
                            <a href="?mode=onair" target="_blank" class="block text-center p-2 bg-blue-600 rounded hover:bg-blue-500 text-xs font-bold">OPEN DISPLAY ‚Üó</a>
                        </div>
                    </div>

                    <div class="flex-1 p-6 overflow-y-auto bg-[#0f1218]">
                        <div class="max-w-5xl mx-auto space-y-3">
                             <div class="flex justify-between items-end mb-4 px-2">
                                <h2 class="text-xl font-bold">Party Scoring</h2>
                                <div class="text-xs text-slate-500 font-mono">TOTAL: <span id="total-seats" class="text-white text-lg font-bold">0</span>/500</div>
                            </div>
                            ${state.parties.map((p, i) => `
                                <div class="bg-slate-900/60 p-3 rounded-lg border-l-4 flex items-center gap-4 shadow-sm hover:bg-slate-800 transition" style="border-color:${p.color}">
                                    <div class="flex items-center gap-2 w-1/4">
                                        <input type="color" value="${p.color}" onchange="updateVal(${i}, 'color', this.value)" class="w-6 h-6 rounded border-0 cursor-pointer">
                                        <input type="text" value="${p.name}" oninput="updateVal(${i}, 'name', this.value)" class="bg-transparent font-bold text-lg w-full focus:outline-none">
                                    </div>
                                    
                                    <div class="flex-1 bg-black/20 p-2 rounded flex flex-col items-center">
                                        <span class="text-[10px] text-slate-500 uppercase">‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏Ç‡∏ï</span>
                                        <div class="flex items-center gap-2">
                                            <button onclick="adj(${i}, 'zone', -1)" class="w-6 h-6 rounded bg-slate-700 hover:bg-red-500 transition">-</button>
                                            <input type="number" value="${p.zone}" oninput="updateVal(${i}, 'zone', this.value)" class="w-16 bg-transparent text-center font-tech font-bold text-xl text-yellow-400 focus:outline-none">
                                            <button onclick="adj(${i}, 'zone', 1)" class="w-6 h-6 rounded bg-slate-700 hover:bg-green-500 transition">+</button>
                                        </div>
                                    </div>
                                    
                                    <div class="flex-1 bg-black/20 p-2 rounded flex flex-col items-center">
                                        <span class="text-[10px] text-slate-500 uppercase">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</span>
                                        <div class="flex items-center gap-2">
                                            <button onclick="adj(${i}, 'list', -1)" class="w-6 h-6 rounded bg-slate-700 hover:bg-red-500 transition">-</button>
                                            <input type="number" value="${p.list}" oninput="updateVal(${i}, 'list', this.value)" class="w-16 bg-transparent text-center font-tech font-bold text-xl text-blue-400 focus:outline-none">
                                            <button onclick="adj(${i}, 'list', 1)" class="w-6 h-6 rounded bg-slate-700 hover:bg-green-500 transition">+</button>
                                        </div>
                                    </div>

                                    <div class="w-16 text-center">
                                        <div class="text-[10px] text-slate-500">SUM</div>
                                        <div class="text-2xl font-tech font-bold">${p.zone + p.list}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>`;
            calcTotal();
        }

        window.updateVal = (i, k, v) => {
            if(k==='zone' || k==='list') v = parseInt(v) || 0;
            state.parties[i][k] = v;
            saveState(state);
            calcTotal();
        };
        window.adj = (i, k, delta) => {
            state.parties[i][k] = Math.max(0, state.parties[i][k] + delta);
            saveState(state);
            renderUI(); 
        };
        window.setScene = (s) => { state.scene = s; saveState(state); renderUI(); };
        window.setBg = (b) => { state.bg = b; saveState(state); };
        window.setTicker = (t) => { state.ticker = t; saveState(state); };
        window.calcTotal = () => {
             const t = state.parties.reduce((a,b) => a + b.zone + b.list, 0);
             const el = document.getElementById('total-seats');
             if(el) el.innerText = t;
        };
        window.getSceneIcon = (s) => {
            return { dashboard: 'üìä', chart: 'üç©', parliament: 'üèõÔ∏è', winner: 'üèÜ' }[s] || 'üì∫';
        }

        renderUI();
    }

    // --- 5. ON-AIR DISPLAY ---
    function initOnAir() {
        document.title = "ON AIR";
        
        // Structure
        app.innerHTML = `
            <div id="main-view" class="w-full h-full flex flex-col bg-main bg-slate-950 transition-colors duration-500 relative">
                <div class="h-20 flex justify-between items-center px-10 z-50 obs-hide pt-4">
                    <div class="flex items-center gap-3 bg-black/40 px-4 py-2 rounded-full border border-white/10 backdrop-blur-md">
                        <div class="w-2 h-2 rounded-full bg-red-500 animate-ping"></div>
                        <div class="w-2 h-2 rounded-full bg-red-500 absolute"></div>
                        <span class="font-bold text-sm text-slate-200 tracking-wider">LIVE DATA</span>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-slate-400 font-bold uppercase">Current Time</div>
                        <div id="clock" class="font-tech font-bold text-3xl text-white leading-none">00:00:00</div>
                    </div>
                </div>

                <div id="stage" class="flex-1 relative p-10 flex items-center justify-center"></div>

                <div class="h-16 bg-slate-900 border-t border-slate-800 flex items-center shadow-2xl relative z-40">
                    <div class="bg-gradient-to-r from-orange-600 to-red-600 h-full px-8 flex flex-col justify-center items-center shrink-0 z-10">
                        <span class="font-tech font-bold text-xl text-white tracking-widest italic">BREAKING</span>
                    </div>
                    <div class="flex-1 ticker-wrap bg-slate-950/80 h-full flex items-center">
                        <div id="ticker-text" class="ticker text-xl font-light text-slate-200 px-4 pt-1">Loading...</div>
                    </div>
                </div>
            </div>`;

        // Clock
        setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString('th-TH'), 1000);

        // Smart Update Loop
        let currentScene = '';
        
        setInterval(() => {
            const newState = loadState();
            
            // 1. BG & Ticker
            const view = document.getElementById('main-view');
            if(newState.bg === 'transparent') document.body.classList.add('transparent');
            else document.body.classList.remove('transparent');
            document.getElementById('ticker-text').innerText = newState.ticker;

            // 2. Scene Management
            const stage = document.getElementById('stage');
            
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Scene: ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏≤‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡πÉ‡∏´‡∏°‡πà
            if (newState.scene !== currentScene) {
                renderSceneStructure(stage, newState);
                currentScene = newState.scene;
            } else {
                // ‡∏ñ‡πâ‡∏≤ Scene ‡πÄ‡∏î‡∏¥‡∏°: ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏Ñ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (Update Values Only)
                updateSceneValues(newState);
            }

            state = newState; // Sync local state
        }, 300); // Check every 300ms
    }

    // --- 6. SCENE RENDERERS (THE FIX) ---

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Scene ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡∏™‡∏£‡πâ‡∏≤‡∏á DOM ‡πÉ‡∏´‡∏°‡πà)
    function renderSceneStructure(container, data) {
        // ‡∏ó‡∏≥‡∏•‡∏≤‡∏¢ Chart ‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
        if(chartInstance) { chartInstance.destroy(); chartInstance = null; }
        
        container.innerHTML = ''; // Clear
        const sorted = [...data.parties].sort((a,b)=>(b.zone+b.list)-(a.zone+a.list));

        // üü¢ SCENE 1: DASHBOARD
        if(data.scene === 'dashboard') {
            let html = `<div class="w-full max-w-6xl space-y-3 fade-enter">
                <div class="flex text-xs text-slate-500 uppercase tracking-widest px-6 mb-1">
                    <div class="w-16">Rank</div>
                    <div class="flex-1">Party</div>
                    <div class="w-32 text-center">Zone</div>
                    <div class="w-32 text-center">List</div>
                    <div class="w-40 text-right">Total</div>
                </div>`;
            
            sorted.forEach((p, i) => {
                const total = p.zone + p.list;
                // FIX: ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤ ${p.zone} ‡∏•‡∏á‡πÑ‡∏õ‡πÄ‡∏•‡∏¢ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ Update Loop ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡πá‡∏ô 0
                html += `
                <div class="glass-panel p-4 rounded-xl flex items-center border-l-4 relative overflow-hidden group transition-all" style="border-color:${p.color}">
                    <div class="w-16 font-tech text-3xl font-bold text-slate-600">#${i+1}</div>
                    <div class="flex-1 z-10">
                        <h2 class="text-2xl font-bold text-white mb-1">${p.name}</h2>
                        <div class="w-full h-1.5 bg-slate-800 rounded-full overflow-hidden">
                            <div class="h-full transition-all duration-1000" style="width:${(total/500)*100}%; background:${p.color}" id="bar-${p.id}"></div>
                        </div>
                    </div>
                    <div class="w-32 text-center text-2xl font-tech font-bold text-yellow-500" id="val-zone-${p.id}">${p.zone}</div>
                    <div class="w-32 text-center text-2xl font-tech font-bold text-blue-400" id="val-list-${p.id}">${p.list}</div>
                    <div class="w-40 text-right text-5xl font-tech font-bold text-white glow-num" id="val-total-${p.id}" style="color:${p.color}">${total}</div>
                </div>`;
            });
            html += `</div>`;
            container.innerHTML = html;
        }

        // üü¢ SCENE 2: CHART (DONUT)
        else if(data.scene === 'chart') {
            container.innerHTML = `
                <div class="glass-panel p-10 rounded-3xl flex flex-col items-center justify-center fade-enter border border-white/10 relative">
                    <h2 class="text-3xl font-bold mb-6 text-white uppercase tracking-widest">Parliament Composition</h2>
                    <div style="width: 600px; height: 600px;">
                        <canvas id="seatsChart"></canvas>
                    </div>
                </div>`;
            
            // Init Chart.js
            const ctx = document.getElementById('seatsChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: sorted.map(p => p.name),
                    datasets: [{
                        data: sorted.map(p => p.zone + p.list),
                        backgroundColor: sorted.map(p => p.color),
                        borderWidth: 0,
                        hoverOffset: 20
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: { position: 'bottom', labels: { color: 'white', font: { size: 16, family:'Anuphan' }, padding: 20 } },
                        datalabels: { color: '#fff', font: { weight: 'bold', size: 20 }, formatter: (value) => value > 0 ? value : '' }
                    },
                    animation: { animateScale: true }
                },
                plugins: [ChartDataLabels]
            });
        }

        // üü¢ SCENE 3: PARLIAMENT (DOTS)
        else if(data.scene === 'parliament') {
            let dotsHtml = '';
            let idx = 0;
            let colorMap = []; sorted.forEach(p=>{ for(let i=0;i<p.zone+p.list;i++) colorMap.push(p.color); });

            // Generate Semicircle Dots
            for(let r=0; r<12; r++) {
                const radius = 35 + (r * 4.5);
                const count = Math.floor(18 + r * 5); 
                const step = 180/(count-1);
                for(let a=0; a<count; a++) {
                    if(idx>=500) break;
                    const rad = (180-(a*step))*(Math.PI/180);
                    // Use CSS Variable for Color to allow updates if needed, but simple re-render is fine for dots
                    const c = colorMap[idx] || '#334155';
                    dotsHtml += `<div class="absolute w-[1.2%] pb-[1.2%] rounded-full shadow-sm transition-colors duration-500" style="left:${50+radius*Math.cos(rad)}%; top:${90-radius*Math.sin(rad)}%; background:${c}; transform:translate(-50%,-50%);"></div>`;
                    idx++;
                }
            }

            container.innerHTML = `
                <div class="relative w-[1100px] aspect-[2/1] fade-enter">
                    ${dotsHtml}
                    <div class="absolute bottom-0 left-1/2 -translate-x-1/2 text-center glass-panel px-16 py-8 rounded-2xl border border-white/10 shadow-2xl backdrop-blur-xl mb-6">
                        <div class="text-xs text-slate-400 uppercase tracking-widest mb-2">Current Leader</div>
                        <h1 class="text-6xl font-bold text-white mb-2 drop-shadow-lg">${sorted[0].name}</h1>
                        <div class="text-9xl font-tech font-bold" style="color:${sorted[0].color}">${sorted[0].zone + sorted[0].list}</div>
                    </div>
                </div>`;
        }

        // üü¢ SCENE 4: WINNER
        else if(data.scene === 'winner') {
            const w = sorted[0];
            const t = w.zone + w.list;
            container.innerHTML = `
                <div class="text-center relative z-10 fade-enter">
                    <div class="absolute inset-0 bg-${w.color} blur-[150px] opacity-20 z-0 animate-pulse"></div>
                    <div class="glass-panel p-20 rounded-[3rem] border border-white/20 shadow-2xl relative z-10 bg-slate-900/60 backdrop-blur-2xl">
                        <div class="text-8xl mb-6 animate-bounce drop-shadow-lg">üëë</div>
                        <div class="text-2xl font-bold text-slate-300 tracking-[0.6em] mb-4 uppercase">Projected Winner</div>
                        <h1 class="text-9xl font-bold text-white mb-8 drop-shadow-2xl">${w.name}</h1>
                        <div class="flex gap-8 justify-center">
                            <div class="bg-white/5 px-8 py-4 rounded-xl border border-white/10">
                                <div class="text-xs uppercase text-slate-400">Total Seats</div>
                                <div class="text-7xl font-tech font-bold text-white">${t}</div>
                            </div>
                        </div>
                    </div>
                </div>`;
        }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ñ‡∏µ‡πà‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏Ñ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á)
    function updateSceneValues(data) {
        if(data.scene === 'dashboard') {
            data.parties.forEach(p => {
                const t = p.zone + p.list;
                animateNum(`val-zone-${p.id}`, p.zone);
                animateNum(`val-list-${p.id}`, p.list);
                animateNum(`val-total-${p.id}`, t);
                
                const bar = document.getElementById(`bar-${p.id}`);
                if(bar) bar.style.width = `${(t/500)*100}%`;
            });
        }
        else if(data.scene === 'chart' && chartInstance) {
            // Update Chart Data Non-Destructively
            const sorted = [...data.parties].sort((a,b)=>(b.zone+b.list)-(a.zone+a.list));
            chartInstance.data.datasets[0].data = sorted.map(p => p.zone + p.list);
            chartInstance.data.datasets[0].backgroundColor = sorted.map(p => p.color);
            chartInstance.data.labels = sorted.map(p => p.name);
            chartInstance.update('none'); // Update without full animation reset
        }
        // Parliament & Winner scenes usually require full redraw on change or complex logic
        // But since we re-render structure on scene change, we are fine.
        // If data updates LIVE while in Parliament scene, we could optimize dots update here.
    }

    function animateNum(id, newVal) {
        const el = document.getElementById(id);
        if(!el) return;
        const oldVal = parseInt(el.innerText) || 0;
        if(oldVal !== newVal) {
            gsap.to(el, {
                innerHTML: newVal,
                duration: 0.5,
                snap: { innerHTML: 1 },
                ease: "power1.out"
            });
        }
    }
</script>
</body>
</html>
