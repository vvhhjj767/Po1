<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PO1 OMEGA ELECTION SYSTEM</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Anuphan:wght@300;400;600;700&family=Chakra+Petch:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root { --bg-dark: #0f172a; --glass: rgba(30, 41, 59, 0.9); --accent: #3b82f6; }
        body { font-family: 'Anuphan', sans-serif; background-color: var(--bg-dark); color: white; overflow: hidden; }
        .font-tech { font-family: 'Chakra Petch', sans-serif; }
        
        /* UI Components */
        .glass-panel { 
            background: var(--glass); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255,255,255,0.08); 
            box-shadow: 0 10px 40px rgba(0,0,0,0.6); 
        }
        .scene-btn { transition: all 0.2s; border-left: 3px solid transparent; }
        .scene-btn:hover { background: rgba(255,255,255,0.05); }
        .scene-btn.active { background: linear-gradient(90deg, rgba(59,130,246,0.2), transparent); border-left-color: var(--accent); color: var(--accent); font-weight: bold; }

        /* Animation */
        .fade-enter { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
        
        .bar-fill { transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .dot-seat { transition: background-color 0.5s ease; }

        /* Ticker */
        .ticker-container { width: 100vw; overflow: hidden; white-space: nowrap; position: relative; }
        .ticker-track { display: inline-block; white-space: nowrap; padding-left: 100vw; animation: ticker 40s linear infinite; }
        @keyframes ticker { 100% { transform: translate3d(-100%, 0, 0); } }

        /* Hexagon Grid */
        .hex-grid { display: flex; flex-wrap: wrap; gap: 4px; justify-content: center; }
        .hex { width: 40px; height: 44px; background-color: #334155; clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); transition: background-color 0.5s; display:flex; align-items:center; justify-content:center; font-size: 10px; color:rgba(0,0,0,0.5); font-weight:bold; }

        /* Transparent Mode */
        body.transparent .bg-main { background: transparent !important; }
        body.transparent .obs-hide { display: none !important; }
        body.transparent .scene-bg { display: none !important; }
    </style>
</head>
<body>

<div id="app" class="w-full h-full"></div>

<script>
    // --- 1. CONFIG ---
    const STORAGE_KEY = 'PO1_OMEGA_DB';
    const MAX_ZONE = 400;
    const MAX_LIST = 100;

    const DEFAULT_DATA = {
        parties: [
            { id: 'p1', name: '‡∏û‡∏£‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô', color: '#FF9100', zone: 120, list: 30 },
            { id: 'p2', name: '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏ó‡∏¢', color: '#E60000', zone: 100, list: 25 },
            { id: 'p3', name: '‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏à‡πÑ‡∏ó‡∏¢', color: '#0033CC', zone: 50, list: 10 },
            { id: 'p4', name: '‡∏£‡∏ó‡∏™‡∏ä.', color: '#2C3E50', zone: 20, list: 5 },
            { id: 'p5', name: '‡∏û‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏£‡∏±‡∏ê', color: '#166534', zone: 10, list: 2 }
        ],
        scene: 'dashboard', 
        ticker: '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏î‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á 2569 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£...',
        bg: 'dark'
    };

    function loadState() {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : JSON.parse(JSON.stringify(DEFAULT_DATA));
    }
    
    function saveState(s) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
    }

    let state = loadState();
    let chartInstance = null;

    // --- 2. ROUTER ---
    const app = document.getElementById('app');
    const params = new URLSearchParams(window.location.search);
    const mode = params.get('mode');

    if (!mode) renderMenu();
    else if (mode === 'control') initControl();
    else if (mode === 'onair') initOnAir();

    // --- 3. MENU ---
    function renderMenu() {
        app.innerHTML = `
            <div class="h-screen w-screen flex items-center justify-center bg-slate-950 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-900 to-black">
                <div class="glass-panel p-12 rounded-3xl text-center max-w-2xl w-full border border-white/10 shadow-2xl">
                    <h1 class="text-6xl font-tech font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400 mb-2">PO1 OMEGA</h1>
                    <p class="text-slate-500 mb-10 text-sm uppercase tracking-[0.3em]">Advanced Election System</p>
                    <div class="grid grid-cols-2 gap-6">
                        <button onclick="location.href='?mode=control'" class="group h-32 bg-slate-900 border border-slate-800 rounded-2xl hover:border-blue-500 transition-all flex flex-col items-center justify-center">
                            <span class="text-4xl mb-2">üéõÔ∏è</span>
                            <span class="font-bold text-slate-300 group-hover:text-blue-400">CONTROL</span>
                        </button>
                        <button onclick="location.href='?mode=onair'" class="group h-32 bg-slate-900 border border-slate-800 rounded-2xl hover:border-red-500 transition-all flex flex-col items-center justify-center">
                            <span class="text-4xl mb-2">üì∫</span>
                            <span class="font-bold text-slate-300 group-hover:text-red-400">ON-AIR</span>
                        </button>
                    </div>
                </div>
            </div>`;
    }

    // --- 4. CONTROL ROOM ---
    function initControl() {
        document.title = "Control - PO1";
        
        function renderUI() {
            const totalZone = state.parties.reduce((sum, p) => sum + p.zone, 0);
            const totalList = state.parties.reduce((sum, p) => sum + p.list, 0);

            app.innerHTML = `
                <div class="flex h-screen bg-slate-950 text-white font-sans text-sm">
                    <div class="w-72 glass-panel border-r border-white/5 flex flex-col z-20">
                        <div class="p-5 border-b border-white/10">
                            <div class="flex items-center gap-2 mb-1">
                                <div class="w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_10px_lime]"></div>
                                <h2 class="font-bold text-slate-200 tracking-wide">LIVE CONTROL</h2>
                            </div>
                        </div>
                        
                        <div class="p-4 space-y-1 overflow-y-auto flex-1">
                            <div class="text-[10px] text-slate-500 font-bold uppercase mb-2 px-2">Scenes</div>
                            ${[
                                {id:'dashboard', label:'üìä Dashboard', desc:'‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°'},
                                {id:'parliament', label:'üèõÔ∏è Parliament 500', desc:'‡∏ú‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏á‡∏Å‡∏•‡∏° (‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ)'},
                                {id:'hex', label:'üêù Hexagon Hive', desc:'‡∏£‡∏±‡∏á‡∏ú‡∏∂‡πâ‡∏á (Creative)'},
                                {id:'cards', label:'üÉè Top 3 Cards', desc:'‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏û‡∏£‡∏£‡∏Ñ‡∏ô‡∏≥'},
                                {id:'chart', label:'üç© Donut Chart', desc:'‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏°'},
                                {id:'winner', label:'üèÜ Winner', desc:'‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ä‡∏±‡∏¢‡∏ä‡∏ô‡∏∞'}
                            ].map(s => `
                                <button onclick="setScene('${s.id}')" class="scene-btn w-full text-left p-3 rounded-lg mb-1 ${state.scene===s.id ? 'active' : 'text-slate-400'}">
                                    <div class="font-bold">${s.label}</div>
                                    <div class="text-[10px] opacity-60 font-normal">${s.desc}</div>
                                </button>
                            `).join('')}
                        </div>

                        <div class="p-4 border-t border-white/10 space-y-3 bg-black/20">
                            <div>
                                <div class="text-[10px] text-slate-500 font-bold uppercase mb-1">Background</div>
                                <select onchange="setBg(this.value)" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-xs text-slate-300">
                                    <option value="dark" ${state.bg==='dark'?'selected':''}>Dark Studio</option>
                                    <option value="transparent" ${state.bg==='transparent'?'selected':''}>Transparent (OBS)</option>
                                </select>
                            </div>
                            <textarea id="ticker-input" class="w-full h-12 bg-slate-900 border border-slate-700 rounded p-2 text-xs resize-none text-white" placeholder="Ticker...">${state.ticker}</textarea>
                            <button onclick="pushTicker()" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-2 rounded text-xs font-bold transition">üöÄ UPDATE TICKER</button>
                        </div>
                    </div>

                    <div class="flex-1 p-8 overflow-y-auto bg-[#0b0f17]">
                        <div class="max-w-4xl mx-auto pb-20">
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="bg-slate-900/80 border border-slate-800 p-4 rounded-xl flex justify-between items-center">
                                    <span class="text-slate-400 text-xs uppercase font-bold">Zone (400)</span>
                                    <div class="text-2xl font-tech font-bold ${totalZone >= MAX_ZONE ? 'text-red-500' : 'text-blue-400'}">${totalZone}</div>
                                </div>
                                <div class="bg-slate-900/80 border border-slate-800 p-4 rounded-xl flex justify-between items-center">
                                    <span class="text-slate-400 text-xs uppercase font-bold">List (100)</span>
                                    <div class="text-2xl font-tech font-bold ${totalList >= MAX_LIST ? 'text-red-500' : 'text-green-400'}">${totalList}</div>
                                </div>
                            </div>

                            <div class="space-y-3" id="party-list">
                                ${state.parties.map((p, i) => `
                                    <div class="bg-slate-900 p-4 rounded-xl border-l-4 shadow-lg flex items-center gap-4 group hover:bg-slate-800 transition" style="border-color:${p.color}">
                                        <div class="flex items-center gap-2 w-1/4">
                                            <input type="color" value="${p.color}" onchange="updateVal(${i}, 'color', this.value)" class="w-8 h-8 rounded border-0 bg-transparent cursor-pointer">
                                            <input type="text" value="${p.name}" oninput="updateVal(${i}, 'name', this.value)" class="bg-transparent font-bold text-lg w-full focus:outline-none">
                                        </div>
                                        
                                        <div class="flex-1 bg-black/20 p-2 rounded-lg flex items-center justify-center gap-2">
                                            <span class="text-[9px] text-slate-500 uppercase font-bold mr-2">Zone</span>
                                            <button onclick="adj(${i}, 'zone', -1)" class="w-8 h-8 rounded bg-slate-700 hover:bg-red-500 font-bold">-</button>
                                            <input type="number" value="${p.zone}" onchange="manualInput(${i}, 'zone', this.value)" class="w-16 bg-transparent text-center font-tech font-bold text-2xl text-yellow-400 focus:outline-none">
                                            <button onclick="adj(${i}, 'zone', 1)" class="w-8 h-8 rounded bg-slate-700 hover:bg-green-500 font-bold" ${totalZone >= MAX_ZONE ? 'disabled style="opacity:0.3"' : ''}>+</button>
                                        </div>
                                        
                                        <div class="flex-1 bg-black/20 p-2 rounded-lg flex items-center justify-center gap-2">
                                            <span class="text-[9px] text-slate-500 uppercase font-bold mr-2">List</span>
                                            <button onclick="adj(${i}, 'list', -1)" class="w-8 h-8 rounded bg-slate-700 hover:bg-red-500 font-bold">-</button>
                                            <input type="number" value="${p.list}" onchange="manualInput(${i}, 'list', this.value)" class="w-16 bg-transparent text-center font-tech font-bold text-2xl text-blue-400 focus:outline-none">
                                            <button onclick="adj(${i}, 'list', 1)" class="w-8 h-8 rounded bg-slate-700 hover:bg-green-500 font-bold" ${totalList >= MAX_LIST ? 'disabled style="opacity:0.3"' : ''}>+</button>
                                        </div>

                                        <button onclick="removeParty(${i})" class="w-8 h-8 rounded text-slate-600 hover:text-red-500 hover:bg-red-900/20 transition flex items-center justify-center">√ó</button>
                                    </div>
                                `).join('')}
                            </div>

                            <button onclick="addParty()" class="w-full mt-4 py-3 border-2 border-dashed border-slate-700 rounded-xl text-slate-500 hover:text-white hover:border-slate-500 hover:bg-slate-800 transition font-bold flex items-center justify-center gap-2">
                                <span>+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏£‡∏£‡∏Ñ‡πÉ‡∏´‡∏°‡πà</span>
                            </button>
                        </div>
                    </div>
                </div>`;
        }

        // Logic
        window.updateVal = (i, k, v) => { state.parties[i][k] = v; saveState(state); };
        window.addParty = () => {
            state.parties.push({ id: 'p'+Date.now(), name: '‡∏û‡∏£‡∏£‡∏Ñ‡πÉ‡∏´‡∏°‡πà', color: '#888888', zone: 0, list: 0 });
            saveState(state); renderUI();
        };
        window.removeParty = (i) => {
            if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏û‡∏£‡∏£‡∏Ñ‡∏ô‡∏µ‡πâ?')) { state.parties.splice(i, 1); saveState(state); renderUI(); }
        };
        window.manualInput = (i, type, val) => {
            val = parseInt(val) || 0;
            const currentVal = state.parties[i][type];
            const diff = val - currentVal;
            const total = state.parties.reduce((sum, p) => sum + p[type], 0);
            const limit = type === 'zone' ? MAX_ZONE : MAX_LIST;
            if (total + diff <= limit) { state.parties[i][type] = Math.max(0, val); saveState(state); renderUI(); } 
            else { alert('‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤‡πÄ‡∏ï‡πá‡∏°!'); renderUI(); }
        };
        window.adj = (i, type, delta) => {
            const total = state.parties.reduce((sum, p) => sum + p[type], 0);
            const limit = type === 'zone' ? MAX_ZONE : MAX_LIST;
            if (delta > 0 && total >= limit) return;
            state.parties[i][type] = Math.max(0, state.parties[i][type] + delta);
            saveState(state); renderUI(); 
        };
        window.setScene = (s) => { state.scene = s; saveState(state); renderUI(); };
        window.setBg = (b) => { state.bg = b; saveState(state); };
        window.pushTicker = () => { state.ticker = document.getElementById('ticker-input').value; saveState(state); alert('Ticker Updated!'); };

        renderUI();
    }

    // --- 5. ON-AIR DISPLAY ---
    function initOnAir() {
        document.title = "ON AIR DISPLAY";
        
        app.innerHTML = `
            <div id="main-view" class="w-full h-full flex flex-col bg-main bg-slate-950 transition-colors duration-500 relative overflow-hidden">
                <div class="scene-bg absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10 pointer-events-none"></div>
                
                <div class="h-24 w-full flex justify-between items-center px-12 pt-6 z-50 obs-hide">
                    <div class="flex items-center gap-4">
                        <div class="bg-red-600 text-white text-xs font-bold px-3 py-1 rounded shadow-lg animate-pulse">LIVE</div>
                        <div>
                            <div class="text-white font-bold text-xl leading-none">ELECTION 2026</div>
                            <div class="text-slate-400 text-xs tracking-widest uppercase">Official Count</div>
                        </div>
                    </div>
                    <div class="text-right glass-panel px-4 py-2 rounded-lg">
                        <div class="text-[10px] text-slate-400 font-bold uppercase">Time</div>
                        <div id="clock" class="font-tech font-bold text-2xl text-white leading-none">00:00</div>
                    </div>
                </div>

                <div id="stage" class="flex-1 relative p-10 flex items-center justify-center z-10"></div>

                <div class="h-16 bg-slate-900 border-t border-slate-800 flex items-center shadow-2xl relative z-50">
                    <div class="bg-blue-600 h-full px-10 flex items-center justify-center shrink-0 z-20 shadow-[5px_0_20px_rgba(0,0,0,0.5)]">
                        <span class="font-bold text-white tracking-widest text-lg">UPDATE</span>
                    </div>
                    <div class="ticker-container bg-slate-950/95 h-full flex items-center">
                        <div id="ticker-text" class="ticker-track text-2xl font-light text-slate-200">Waiting for data...</div>
                    </div>
                </div>
            </div>`;

        setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'}), 1000);

        let currentScene = '';
        setInterval(() => {
            const newState = loadState();
            const view = document.getElementById('main-view');
            if(newState.bg === 'transparent') document.body.classList.add('transparent');
            else document.body.classList.remove('transparent');
            
            const tickerEl = document.getElementById('ticker-text');
            if(tickerEl.innerText !== newState.ticker) tickerEl.innerText = newState.ticker;

            const stage = document.getElementById('stage');
            if (newState.scene !== currentScene) {
                renderSceneStructure(stage, newState);
                currentScene = newState.scene;
            } else {
                updateSceneValues(newState);
            }
            state = newState;
        }, 200);
    }

    // --- 6. SCENE RENDERERS ---

    function renderSceneStructure(container, data) {
        if(chartInstance) { chartInstance.destroy(); chartInstance = null; }
        container.innerHTML = ''; 
        const sorted = [...data.parties].sort((a,b)=>(b.zone+b.list)-(a.zone+a.list));

        // 1. PARLIAMENT 500 (THE IMAGE MATCH)
        if(data.scene === 'parliament') {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏∏‡∏î 500 ‡∏à‡∏∏‡∏î ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏±‡πâ‡∏ô (Hemicycle)
            let dotsHtml = '';
            let idx = 0;
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Array ‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á
            let seatColors = [];
            sorted.forEach(p => { for(let i=0; i<p.zone+p.list; i++) seatColors.push(p.color); });
            
            // ‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏à‡∏∏‡∏î (Archimedean-like distribution for hemicycle)
            const rows = 12; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ñ‡∏ß
            const totalSeats = 500;
            let currentSeat = 0;
            
            // ‡∏ß‡∏≤‡∏î‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ß‡πÉ‡∏ô‡∏™‡∏∏‡∏î‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏ô‡∏≠‡∏Å‡∏™‡∏∏‡∏î
            for(let r=1; r<=rows; r++) {
                const radius = 25 + (r * 4); // ‡∏£‡∏±‡∏®‡∏°‡∏µ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏∏‡∏î‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô
                // ‡∏¢‡∏¥‡πà‡∏á‡∏£‡∏±‡∏®‡∏°‡∏µ‡πÄ‡∏¢‡∏≠‡∏∞ ‡∏à‡∏∏‡∏î‡∏¢‡∏¥‡πà‡∏á‡πÄ‡∏¢‡∏≠‡∏∞
                const arcLength = Math.PI * radius;
                let dotsInRow = Math.floor(arcLength / 3.5); // 3.5 ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏∏‡∏î
                
                // ‡∏õ‡∏£‡∏±‡∏ö‡∏à‡∏π‡∏ô‡πÅ‡∏ñ‡∏ß‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 500 ‡∏û‡∏≠‡∏î‡∏µ
                if (r === rows) dotsInRow = totalSeats - currentSeat;
                
                const step = 180 / (dotsInRow + 1);
                
                for(let i=0; i<dotsInRow; i++) {
                    if(currentSeat >= totalSeats) break;
                    const angle = (180 - (step * (i+1))) * (Math.PI / 180); // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏ô
                    const x = 50 + (radius * Math.cos(angle)); // 50% ‡∏Ñ‡∏∑‡∏≠‡∏à‡∏∏‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠
                    const y = 90 - (radius * Math.sin(angle)); // 90% ‡∏Ñ‡∏∑‡∏≠‡∏ê‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
                    
                    const color = seatColors[currentSeat] || '#334155'; // ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏ñ‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á
                    dotsHtml += `<div class="dot-seat absolute w-[1.4%] pb-[1.4%] rounded-full shadow-sm" style="left:${x}%; top:${y}%; background:${color}; transform:translate(-50%,-50%);"></div>`;
                    currentSeat++;
                }
            }

            container.innerHTML = `
                <div class="relative w-[1200px] aspect-[1.8/1] fade-enter">
                    ${dotsHtml}
                    <div class="absolute bottom-0 left-1/2 -translate-x-1/2 text-center mb-4">
                        <h1 class="text-7xl font-bold text-slate-700 opacity-20 select-none">500</h1>
                        <div class="text-xl text-slate-400 font-bold uppercase tracking-widest -mt-4">Parliament Seats</div>
                        <div class="bg-white/5 px-6 py-2 rounded-full mt-4 border border-white/10 backdrop-blur-md">
                            <span class="text-slate-400 text-sm mr-2">Majority needed</span>
                            <span class="text-white font-bold text-lg">251</span>
                        </div>
                    </div>
                </div>`;
        }

        // 2. HEXAGON HIVE (Creative)
        else if(data.scene === 'hex') {
            container.innerHTML = `
                <div class="w-full max-w-7xl fade-enter flex flex-col items-center">
                    <h2 class="text-3xl font-bold mb-8 uppercase tracking-widest text-slate-400">Seat Allocation Map</h2>
                    <div class="hex-grid w-[1000px]">
                        ${Array.from({length: 500}).map((_, i) => {
                             // Determine color based on sorted parties
                             let color = '#1e293b';
                             let count = 0;
                             for(let p of sorted) {
                                 if (i < count + (p.zone+p.list)) { color = p.color; break; }
                                 count += (p.zone+p.list);
                             }
                             return `<div class="hex" style="background-color:${color}40; box-shadow:inset 0 0 10px ${color}"></div>`;
                        }).join('')}
                    </div>
                </div>`;
        }

        // 3. DASHBOARD
        else if(data.scene === 'dashboard') {
            container.innerHTML = `
                <div class="w-full max-w-6xl fade-enter space-y-4">
                     <div class="flex text-xs text-slate-500 uppercase tracking-widest px-6">
                        <div class="w-16">Rank</div>
                        <div class="flex-1">Party</div>
                        <div class="w-32 text-center">Zone</div>
                        <div class="w-32 text-center">List</div>
                        <div class="w-40 text-right">Total</div>
                    </div>
                    ${sorted.map((p, i) => `
                        <div class="glass-panel p-4 rounded-xl flex items-center border-l-4 relative overflow-hidden" style="border-color:${p.color}">
                            <div class="w-16 font-tech text-3xl font-bold text-slate-600">#${i+1}</div>
                            <div class="flex-1 z-10">
                                <h2 class="text-2xl font-bold text-white mb-1">${p.name}</h2>
                                <div class="w-full h-2 bg-slate-800 rounded-full overflow-hidden">
                                    <div class="h-full bar-fill" style="width:${((p.zone+p.list)/500)*100}%; background:${p.color}"></div>
                                </div>
                            </div>
                            <div class="w-32 text-center text-2xl font-tech font-bold text-yellow-500">${p.zone}</div>
                            <div class="w-32 text-center text-2xl font-tech font-bold text-blue-400">${p.list}</div>
                            <div class="w-40 text-right text-5xl font-tech font-bold text-white glow-num" style="color:${p.color}">${p.zone+p.list}</div>
                        </div>`).join('')}
                </div>`;
        }

        // 4. CARDS (Top 3)
        else if(data.scene === 'cards') {
            const top3 = [sorted[1], sorted[0], sorted[2]].filter(Boolean); // 2nd, 1st, 3rd
            container.innerHTML = `
                <div class="flex items-end justify-center gap-8 w-full max-w-7xl fade-enter h-[600px]">
                    ${top3.map((p, i) => {
                        const isFirst = p === sorted[0];
                        const h = isFirst ? 'h-[500px]' : 'h-[420px]';
                        const w = isFirst ? 'w-[380px]' : 'w-[320px]';
                        const rank = p === sorted[0] ? 1 : (p === sorted[1] ? 2 : 3);
                        return `
                        <div class="${w} ${h} glass-panel rounded-3xl flex flex-col items-center p-8 border-t-8 shadow-2xl relative transition-all duration-500 hover:-translate-y-2" style="border-color:${p.color}">
                            <div class="bg-slate-900 px-4 py-1 rounded-full text-xs font-bold uppercase text-slate-400 mb-6">Rank ${rank}</div>
                            <h2 class="text-4xl font-bold text-center mb-2 h-20 flex items-center justify-center">${p.name}</h2>
                            <div class="flex-1 flex items-center justify-center">
                                <div class="text-[8rem] font-tech font-bold leading-none glow-num" style="color:${p.color}">${p.zone+p.list}</div>
                            </div>
                            <div class="w-full grid grid-cols-2 gap-2 text-center">
                                <div class="bg-white/5 p-2 rounded">
                                    <div class="text-[10px] text-slate-400 uppercase">Zone</div>
                                    <div class="text-2xl font-bold">${p.zone}</div>
                                </div>
                                <div class="bg-white/5 p-2 rounded">
                                    <div class="text-[10px] text-slate-400 uppercase">List</div>
                                    <div class="text-2xl font-bold">${p.list}</div>
                                </div>
                            </div>
                        </div>`;
                    }).join('')}
                </div>`;
        }

        // 5. CHART
        else if(data.scene === 'chart') {
            container.innerHTML = `
                <div class="glass-panel p-10 rounded-3xl flex flex-col items-center justify-center fade-enter relative bg-slate-900/90">
                    <h2 class="text-3xl font-bold mb-6 text-white uppercase tracking-widest">Seat Distribution</h2>
                    <div style="width: 600px; height: 600px;">
                        <canvas id="seatsChart"></canvas>
                    </div>
                </div>`;
            const ctx = document.getElementById('seatsChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: sorted.map(p => p.name),
                    datasets: [{
                        data: sorted.map(p => p.zone + p.list),
                        backgroundColor: sorted.map(p => p.color),
                        borderWidth: 0,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '55%',
                    plugins: {
                        legend: { position: 'bottom', labels: { color: 'white', font: { size: 14, family:'Anuphan' }, padding: 20 } },
                        datalabels: { color: '#fff', font: { weight: 'bold', size: 18 }, formatter: (v) => v > 0 ? v : '' }
                    }
                },
                plugins: [ChartDataLabels]
            });
        }
        
        // 6. WINNER
        else if(data.scene === 'winner') {
            const w = sorted[0];
            container.innerHTML = `
                <div class="text-center relative z-10 fade-enter">
                    <div class="absolute inset-0 bg-${w.color} blur-[150px] opacity-20 z-0 animate-pulse"></div>
                    <div class="glass-panel p-24 rounded-[3rem] border border-white/20 shadow-2xl relative z-10 bg-slate-900/80 backdrop-blur-3xl">
                        <div class="text-8xl mb-6 animate-bounce drop-shadow-lg">üèÜ</div>
                        <div class="text-2xl font-bold text-slate-400 tracking-[0.5em] mb-4 uppercase">Projected Winner</div>
                        <h1 class="text-9xl font-bold text-white mb-8 drop-shadow-2xl">${w.name}</h1>
                        <div class="text-[10rem] font-tech font-bold leading-none glow-num" style="color:${w.color}">${w.zone + w.list}</div>
                    </div>
                </div>`;
        }
    }

    function updateSceneValues(data) {
        // Simple re-render for this demo to ensure consistent visuals
        // Ideally, we would diff numbers here, but structure re-render is safer for dynamic party lists
    }
</script>
</body>
</html>
